---
import "../styles/global.css";

import { sanityClient } from "sanity:client";

import { FaqBlock } from "@/components/faq-block";
import { Footer3 } from "@/components/footer3";
import { HeroBlock } from "@/components/hero-block";
import { Navbar3 } from "@/components/navbar3";
import { GlossaryBlock } from "@/components/glossary-block";
import { BenefitsBlock } from "@/components/benefits-block";
import { HowItWorksBlock } from "@/components/how-it-works-block";
import { AdditionalFeaturesBlock } from "@/components/additional-features-block";
import { FeaturesExpandableBlock } from "@/components/features-expandable-block";
import { Bento2x2Block } from "@/components/bento-2x2-block";
import { BlackCta } from "@/components/black-cta";
import { AdditionalFeaturesBlock2 } from "@/components/additional-features-block-2";
import { FeaturesSliderBlock } from "@/components/features-slider-block";
import { TestimonialsBlock } from "@/components/testimonials-block";
import { CtaMain } from "@/components/cta-main";

// Отримуємо дані з Sanity для landing page
const landingPageData = await sanityClient.fetch(
  `*[_type == "landingPage"][0]{
    heroBackgroundImage,
    heroLabel{
      text,
      iconName,
      iconPrefix
    },
    heroHeadingStart,
    heroHeadingMiddle,
    heroHeadingEnd,
    heroSubheading,
    heroPrimaryCtaLabel,
    heroSecondaryCtaLabel,
    heroTags[]{
      text,
      iconName,
      iconPrefix
    },
    benefitsBlockTitle,
    benefitsBlockFeatures[]{
      heading,
      description,
      iconName,
      iconPrefix
    },
    glossaryBlockLabel{
      text,
      iconName,
      iconPrefix
    },
    glossaryBlockHeading{
      prefix,
      main
    },
    glossaryBlockDescription[]{
      text,
      iconName,
      iconPrefix
    },
    howItWorksBlockHeader{
      label,
      iconName,
      iconPrefix,
      title,
      description
    },
    howItWorksBlockFeatures[]{
      id,
      heading,
      description,
      iconName,
      iconPrefix,
      image,
      url,
      isDefault
    },
    additionalFeaturesBlockFeatures[]{
      title,
      text,
      iconName,
      iconPrefix
    },
    featuresExpandableBlockHeader{
      label,
      iconName,
      iconPrefix,
      title,
      description
    },
    featuresExpandableBlockFeatures[]{
      id,
      title,
      description,
      description2,
      iconName,
      iconPrefix,
      image
    }
  }`
);

// Підготовлюємо дані для HeroBlock
const heroProps = landingPageData
  ? {
      backgroundImage: landingPageData.heroBackgroundImage || undefined,
      label: landingPageData.heroLabel && 
             landingPageData.heroLabel.text && 
             landingPageData.heroLabel.iconName
        ? {
            text: landingPageData.heroLabel.text,
            iconName: landingPageData.heroLabel.iconName,
            iconPrefix: landingPageData.heroLabel.iconPrefix || "fas",
          }
        : undefined,
      headingStart: landingPageData.heroHeadingStart || undefined,
      headingMiddle: landingPageData.heroHeadingMiddle || undefined,
      headingEnd: landingPageData.heroHeadingEnd || undefined,
      subheading: landingPageData.heroSubheading || undefined,
      primaryCta: landingPageData.heroPrimaryCtaLabel
        ? { label: landingPageData.heroPrimaryCtaLabel }
        : undefined,
      secondaryCta: landingPageData.heroSecondaryCtaLabel
        ? { label: landingPageData.heroSecondaryCtaLabel }
        : undefined,
      bottomTags: Array.isArray(landingPageData.heroTags) && landingPageData.heroTags.length > 0
        ? landingPageData.heroTags
            .filter((tag: any) => tag && tag.text && tag.iconName)
            .map((tag: any) => ({
              text: tag.text,
              iconName: tag.iconName,
              iconPrefix: tag.iconPrefix || "fas",
            }))
        : undefined,
    }
  : {};

// Підготовлюємо дані для BenefitsBlock (з fallback на значення за замовчуванням)
const benefitsBlockData =
  landingPageData?.benefitsBlockFeatures &&
  landingPageData.benefitsBlockFeatures.length > 0
    ? landingPageData.benefitsBlockFeatures.map((feature: any) => ({
        heading: feature.heading,
        description: feature.description,
        iconName: feature.iconName,
        iconPrefix: feature.iconPrefix || "fad",
      }))
    : undefined; // Якщо немає даних в Sanity, використовуватимуться значення за замовчуванням з компонента

// Підготовлюємо дані для GlossaryBlock
const glossaryBlockProps = landingPageData
  ? {
      label: landingPageData.glossaryBlockLabel && 
             landingPageData.glossaryBlockLabel.text && 
             landingPageData.glossaryBlockLabel.iconName
        ? {
            text: landingPageData.glossaryBlockLabel.text,
            iconName: landingPageData.glossaryBlockLabel.iconName,
            iconPrefix: landingPageData.glossaryBlockLabel.iconPrefix || "fas",
          }
        : undefined,
      heading: landingPageData.glossaryBlockHeading &&
               (landingPageData.glossaryBlockHeading.prefix || landingPageData.glossaryBlockHeading.main)
        ? {
            prefix: landingPageData.glossaryBlockHeading.prefix || "",
            main: landingPageData.glossaryBlockHeading.main || "",
          }
        : undefined,
      description: Array.isArray(landingPageData.glossaryBlockDescription) &&
                   landingPageData.glossaryBlockDescription.length > 0
        ? {
            parts: landingPageData.glossaryBlockDescription
              .filter((part: any) => part && part.text)
              .map((part: any) => ({
                text: part.text,
                icon: part.iconName
                  ? {
                      iconName: part.iconName,
                      iconPrefix: part.iconPrefix || "far",
                    }
                  : undefined,
              })),
          }
        : undefined,
    }
  : {};

// Підготовлюємо дані для HowItWorksBlock
const howItWorksBlockProps = landingPageData
  ? {
      header: landingPageData.howItWorksBlockHeader &&
             (landingPageData.howItWorksBlockHeader.label || 
              landingPageData.howItWorksBlockHeader.title)
        ? {
            label: landingPageData.howItWorksBlockHeader.label || "",
            iconName: landingPageData.howItWorksBlockHeader.iconName || "",
            iconPrefix: landingPageData.howItWorksBlockHeader.iconPrefix || "fas",
            title: landingPageData.howItWorksBlockHeader.title || "",
            description: landingPageData.howItWorksBlockHeader.description || "",
          }
        : undefined,
      features: Array.isArray(landingPageData.howItWorksBlockFeatures) &&
                landingPageData.howItWorksBlockFeatures.length > 0
        ? landingPageData.howItWorksBlockFeatures
            .filter((feature: any) => feature && feature.id && feature.heading)
            .map((feature: any) => ({
              id: feature.id,
              heading: feature.heading,
              description: feature.description || "",
              iconName: feature.iconName,
              iconPrefix: feature.iconPrefix || "fas",
              image: feature.image || "",
              url: feature.url || "",
              isDefault: feature.isDefault || false,
            }))
        : undefined,
    }
  : {};

// Підготовлюємо дані для AdditionalFeaturesBlock
const additionalFeaturesBlockData =
  landingPageData?.additionalFeaturesBlockFeatures &&
  landingPageData.additionalFeaturesBlockFeatures.length > 0
    ? landingPageData.additionalFeaturesBlockFeatures.map((feature: any) => ({
        title: feature.title,
        text: feature.text,
        iconName: feature.iconName,
        iconPrefix: feature.iconPrefix || "fas",
      }))
    : undefined;

// Підготовлюємо дані для FeaturesExpandableBlock
const featuresExpandableBlockProps = landingPageData
  ? {
      header: landingPageData.featuresExpandableBlockHeader &&
             (landingPageData.featuresExpandableBlockHeader.label ||
              landingPageData.featuresExpandableBlockHeader.title)
        ? {
            label: landingPageData.featuresExpandableBlockHeader.label || "",
            iconName: landingPageData.featuresExpandableBlockHeader.iconName || "",
            iconPrefix: landingPageData.featuresExpandableBlockHeader.iconPrefix || "fas",
            title: landingPageData.featuresExpandableBlockHeader.title || "",
            description: landingPageData.featuresExpandableBlockHeader.description || "",
          }
        : undefined,
      features: Array.isArray(landingPageData.featuresExpandableBlockFeatures) &&
                landingPageData.featuresExpandableBlockFeatures.length > 0
        ? landingPageData.featuresExpandableBlockFeatures
            .filter((feature: any) => feature && feature.id && feature.title)
            .map((feature: any) => ({
              id: feature.id,
              title: feature.title,
              description: feature.description || "",
              description2: feature.description2 || undefined,
              iconName: feature.iconName,
              iconPrefix: feature.iconPrefix || "fas",
              image: feature.image || "",
            }))
        : undefined,
    }
  : {};

const faqItems = [
  {
    id: "faq-1",
    question: "What is a FAQ?",
    answer:
      "A FAQ is a list of frequently asked questions and answers on a particular topic.",
  },
  {
    id: "faq-2",
    question: "What is the purpose of a FAQ?",
    answer:
      "The purpose of a FAQ is to provide answers to common questions and help users find the information they need quickly and easily.",
  },
  {
    id: "faq-3",
    question: "How do I create a FAQ?",
    answer:
      "To create a FAQ, you need to compile a list of common questions and answers on a particular topic and organize them in a clear and easy-to-navigate format.",
  },
  {
    id: "faq-4",
    question: "What are the benefits of a FAQ?",
    answer:
      "The benefits of a FAQ include providing quick and easy access to information, reducing the number of support requests, and improving the overall user experience.",
  },
  {
    id: "faq-5",
    question: "How should I organize my FAQ?",
    answer:
      "You should organize your FAQ in a logical manner, grouping related questions together and ordering them from most basic to more advanced topics.",
  },
  {
    id: "faq-6",
    question: "How long should FAQ answers be?",
    answer:
      "FAQ answers should be concise and to the point, typically a few sentences or a short paragraph is sufficient for most questions.",
  },
  {
    id: "faq-7",
    question: "Should I include links in my FAQ?",
    answer:
      "Yes, including links to more detailed information or related resources can be very helpful for users who want to learn more about a particular topic.",
  },
];
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />
    <title>Astro + shadcn landing</title>
  </head>
  <body>
    <header class="border-b">
      <Navbar3 client:load />
    </header>
    <main class="pt-[72px]">
      <HeroBlock client:load {...heroProps} />
      <GlossaryBlock client:load {...glossaryBlockProps} />
      <BenefitsBlock 
        client:load 
        title={landingPageData?.benefitsBlockTitle}
        features={benefitsBlockData}
      />
      <HowItWorksBlock client:load {...howItWorksBlockProps} />
      <AdditionalFeaturesBlock 
        client:load 
        features={additionalFeaturesBlockData}
      />
      <FeaturesExpandableBlock 
        client:load 
        {...featuresExpandableBlockProps}
      />
      <Bento2x2Block client:load />
      <BlackCta client:load />
      <AdditionalFeaturesBlock2 client:load />
      <FeaturesSliderBlock client:load />
      <TestimonialsBlock client:load />
      <CtaMain client:load />
      <FaqBlock
        client:load
        title="Frequently asked questions"
        description="Find answers to common questions about our products. Can't find what you're looking for? Contact our support team."
        items={faqItems}
      />
    </main>
    <Footer3 client:load />
  </body>
</html>
